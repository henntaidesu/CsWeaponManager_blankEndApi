# YYYPæ­¦å™¨ClassIDæ¨¡å—å®Œæˆè¯´æ˜

## ğŸ“‹ ä»»åŠ¡å®Œæˆæ¸…å•

### âœ… 1. æ•°æ®åº“æ¨¡å‹åˆ›å»º
**æ–‡ä»¶**: `blankEndApi/src/db_manager/yyyp/yyyp_weapon_classID.py`

**åŒ…å«åŠŸèƒ½**:
- âœ… åŸºç¡€æ•°æ®æ¨¡å‹ `YyypWeaponClassIDModel`
- âœ… 7ä¸ªæ•°æ®å­—æ®µ: `Id`, `CommodityName`, `weapon_type`, `weapon_name`, `item_name`, `OnSaleCount`, `OnLeaseCount`
- âœ… 2ä¸ªæ—¶é—´æˆ³å­—æ®µ: `created_at`, `updated_at`
- âœ… 3ä¸ªç´¢å¼•ä¼˜åŒ–: `weapon_type`, `weapon_name`, `item_name`
- âœ… 5ä¸ªè‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•:
  - `find_by_weapon_info()` - æ ¹æ®æ­¦å™¨ä¿¡æ¯æŸ¥è¯¢
  - `find_by_commodity_name()` - æ ¹æ®å•†å“åç§°æŸ¥è¯¢
  - `get_available_weapons()` - è·å–å¯ç”¨æ­¦å™¨
  - `batch_insert_or_update()` - æ‰¹é‡æ’å…¥æˆ–æ›´æ–°

### âœ… 2. åç«¯APIæ¥å£åˆ›å»º
**æ–‡ä»¶**: `blankEndApi/src/web_side/youpin898/select_weapon/select_weapon_v1.py`

**åŒ…å«10ä¸ªAPIæ¥å£**:
1. âœ… `GET /getWeaponList` - è·å–æ‰€æœ‰æ­¦å™¨åˆ—è¡¨
2. âœ… `GET /getWeaponById/<weapon_id>` - æ ¹æ®IDè·å–æ­¦å™¨
3. âœ… `GET /getWeaponByType/<weapon_type>` - æ ¹æ®ç±»å‹è·å–æ­¦å™¨
4. âœ… `POST /searchWeapon` - å¤šæ¡ä»¶æœç´¢æ­¦å™¨
5. âœ… `GET /getAvailableWeapons` - è·å–å¯ç”¨æ­¦å™¨
6. âœ… `POST /batchInsertOrUpdate` - æ‰¹é‡æ’å…¥æˆ–æ›´æ–°
7. âœ… `POST /insertWeapon` - æ’å…¥å•ä¸ªæ­¦å™¨
8. âœ… `PUT /updateWeapon/<weapon_id>` - æ›´æ–°æ­¦å™¨æ•°æ®
9. âœ… `DELETE /deleteWeapon/<weapon_id>` - åˆ é™¤æ­¦å™¨
10. âœ… `GET /getWeaponCount` - è·å–æ­¦å™¨æ€»æ•°

### âœ… 3. æ¨¡å—æ³¨å†Œ
- âœ… å·²åœ¨ `blankEndApi/src/db_manager/yyyp/__init__.py` ä¸­å¯¼å‡ºæ¨¡å‹
- âœ… å·²åœ¨ `blankEndApi/src/db_manager/manager.py` ä¸­æ³¨å†Œæ¨¡å‹åˆ°æ•°æ®åº“ç®¡ç†å™¨
- âœ… å·²åœ¨ `blankEndApi/blankEndApi.py` ä¸­æ³¨å†ŒAPI Blueprint

### âœ… 4. æ–‡æ¡£å’Œæµ‹è¯•
- âœ… APIæ¥å£æ–‡æ¡£: `README.md`
- âœ… æµ‹è¯•è„šæœ¬: `blankEndApi/test_weapon_classid.py`
- âœ… å®Œæˆè¯´æ˜: `å®Œæˆè¯´æ˜.md`

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
blankEndApi/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ db_manager/
â”‚   â”‚   â”œâ”€â”€ yyyp/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py (å·²æ›´æ–° - å¯¼å‡ºYyypWeaponClassIDModel)
â”‚   â”‚   â”‚   â””â”€â”€ yyyp_weapon_classID.py (æ–°å»º - æ•°æ®æ¨¡å‹)
â”‚   â”‚   â””â”€â”€ manager.py (å·²æ›´æ–° - æ³¨å†Œæ–°æ¨¡å‹)
â”‚   â””â”€â”€ web_side/
â”‚       â””â”€â”€ youpin898/
â”‚           â””â”€â”€ select_weapon/
â”‚               â”œâ”€â”€ select_weapon_v1.py (æ–°å»º - APIæ¥å£)
â”‚               â”œâ”€â”€ README.md (æ–°å»º - APIæ–‡æ¡£)
â”‚               â””â”€â”€ å®Œæˆè¯´æ˜.md (æœ¬æ–‡ä»¶)
â”œâ”€â”€ blankEndApi.py (å·²æ›´æ–° - æ³¨å†ŒBlueprint)
â””â”€â”€ test_weapon_classid.py (æ–°å»º - æµ‹è¯•è„šæœ¬)
```

---

## ğŸ“Š æ•°æ®è¡¨ç»“æ„

**è¡¨å**: `yyyp_weapon_classID`

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| Id | INTEGER | PRIMARY KEY | æ­¦å™¨æ¨¡æ¿ID |
| CommodityName | TEXT | NULL | å®Œæ•´å•†å“åç§° |
| weapon_type | TEXT | NULL, INDEX | æ­¦å™¨ç±»å‹ |
| weapon_name | TEXT | NULL, INDEX | æ­¦å™¨åç§° |
| item_name | TEXT | NULL, INDEX | çš®è‚¤åç§° |
| OnSaleCount | INTEGER | NULL | åœ¨å”®æ•°é‡ |
| OnLeaseCount | INTEGER | NULL | ç§Ÿèµæ•°é‡ |
| created_at | DATETIME | DEFAULT NOW | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | DEFAULT NOW | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_weapon_type` on `weapon_type`
- `idx_weapon_name` on `weapon_name`
- `idx_item_name` on `item_name`

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd blankEndApi
python blankEndApi.py
```

æœåŠ¡å°†åœ¨ `http://localhost:9001` å¯åŠ¨

### 2. æµ‹è¯•è¡¨åˆ›å»º
```bash
cd blankEndApi
python test_weapon_classid.py
```

### 3. è®¿é—®APIæ¥å£
APIåŸºç¡€URL: `http://localhost:9001/youpin898SelectWeaponV1`

ç¤ºä¾‹:
- è·å–æ‰€æœ‰æ­¦å™¨: `GET http://localhost:9001/youpin898SelectWeaponV1/getWeaponList`
- æ ¹æ®ç±»å‹æŸ¥è¯¢: `GET http://localhost:9001/youpin898SelectWeaponV1/getWeaponByType/åŒ•é¦–`

### 4. åœ¨çˆ¬è™«ä¸­ä½¿ç”¨

åœ¨ `Spider/src/web_site/youping/select_weapon/select_templateId.py` ä¸­:

```python
import requests

# è·å–æ‰€æœ‰æ­¦å™¨æ•°æ®
selector = selectTemplateId(config)
all_weapons = selector.getAllTemplateIds(['CSGO_Type_Knife_Unlimited'])

# å‘é€åˆ°åç«¯API
api_url = "http://localhost:9001/youpin898SelectWeaponV1/batchInsertOrUpdate"
response = requests.post(api_url, json=all_weapons)

if response.status_code == 200:
    result = response.json()
    print(f"æˆåŠŸæ’å…¥ {result['success_count']} æ¡æ•°æ®")
```

---

## ğŸ”— ä¸çˆ¬è™«æ¨¡å—çš„é›†æˆ

çˆ¬è™«æ¨¡å—å·²å®Œæˆå­—æ®µè§£æ:
- âœ… `Spider/src/web_site/youping/select_weapon/select_templateId.py`
- âœ… `parseJSON()` å‡½æ•°ä¼šè°ƒç”¨ `parse_cs2_name()` è§£ææ­¦å™¨åç§°
- âœ… æå–å­—æ®µ: `Id`, `CommodityName`, `weapon_type`, `weapon_name`, `item_name`, `OnSaleCount`, `OnLeaseCount`

æ•°æ®æµ:
```
æ‚ æ‚ æœ‰å“API 
  â†’ Spiderè§£æ (parseJSON + parse_cs2_name)
  â†’ æå–7ä¸ªå­—æ®µ
  â†’ å‘é€åˆ°åç«¯API
  â†’ å­˜å…¥ yyyp_weapon_classID è¡¨
```

---

## ğŸ“ åç»­å»ºè®®

### 1. å®šæ—¶åŒæ­¥ä»»åŠ¡
å¯ä»¥åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸä»æ‚ æ‚ æœ‰å“è·å–æœ€æ–°æ­¦å™¨æ•°æ®å¹¶æ›´æ–°æ•°æ®åº“:

```python
import schedule
import time

def sync_weapons():
    selector = selectTemplateId(config)
    all_weapons = selector.getAllTemplateIds(weapon_type_list)
    
    # å‘é€åˆ°API
    response = requests.post(api_url, json=all_weapons)
    print(f"åŒæ­¥å®Œæˆ: {response.json()}")

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
schedule.every(1).hours.do(sync_weapons)

while True:
    schedule.run_pending()
    time.sleep(60)
```

### 2. æ•°æ®ç»Ÿè®¡
å¯ä»¥æ·»åŠ æ›´å¤šç»Ÿè®¡åŠŸèƒ½ï¼Œå¦‚:
- å„ç±»å‹æ­¦å™¨æ•°é‡ç»Ÿè®¡
- ä»·æ ¼åŒºé—´åˆ†å¸ƒ
- çƒ­é—¨æ­¦å™¨æ’è¡Œ

### 3. å‰ç«¯å±•ç¤º
å¯ä»¥åœ¨ `WebSite` å‰ç«¯é¡¹ç›®ä¸­æ·»åŠ æ­¦å™¨æµè§ˆé¡µé¢:
- æ­¦å™¨åˆ—è¡¨å±•ç¤º
- ç­›é€‰å’Œæœç´¢
- è¯¦æƒ…æŸ¥çœ‹

---

## âœ… éªŒè¯æ¸…å•

å¯åŠ¨åç«¯æœåŠ¡åï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆå§‹åŒ–ã€‚ä½ å¯ä»¥æ£€æŸ¥:

1. âœ… æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ `yyyp_weapon_classID` è¡¨
2. âœ… è¡¨ç»“æ„æ˜¯å¦åŒ…å«æ‰€æœ‰9ä¸ªå­—æ®µ
3. âœ… æ˜¯å¦åˆ›å»ºäº†3ä¸ªç´¢å¼•
4. âœ… APIæ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®
5. âœ… æµ‹è¯•è„šæœ¬æ˜¯å¦å…¨éƒ¨é€šè¿‡

---

## ğŸ‰ å®Œæˆ

æ‰€æœ‰åŠŸèƒ½å·²æŒ‰è¦æ±‚å®Œæˆ:
- âœ… åç«¯ç›®å½•åˆ›å»º: `blankEndApi/src/web_side/youpin898/select_weapon`
- âœ… æ•°æ®è¡¨æ¨¡å‹: `yyyp_weapon_classID`
- âœ… å­—æ®µåŒ¹é…: ä¸çˆ¬è™«è§£æçš„7ä¸ªå­—æ®µå®Œå…¨ä¸€è‡´
- âœ… APIæ¥å£: 10ä¸ªRESTfulæ¥å£
- âœ… è‡ªåŠ¨åˆå§‹åŒ–: å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºè¡¨
- âœ… å®Œæ•´æ–‡æ¡£: APIæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜

ç°åœ¨å¯ä»¥å¯åŠ¨åç«¯æœåŠ¡ï¼Œè¡¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼

